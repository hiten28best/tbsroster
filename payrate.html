<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay Rate Management</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h2>Employee Pay Rates</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Employee Name</th>
                <th>Normal Pay</th>
                <th>Saturday Pay</th>
                <th>Sunday Pay</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="payrate-table">
            <!-- Employee data will be loaded dynamically -->
        </tbody>
    </table>

    <button onclick="addEmployee()">Add Employee</button>
    <button onclick="saveEmployeeData()">Save Employees</button>

    <script>
        const SPREADSHEET_ID = "1NombWTsHDX-zvugvEYihqTld1mmh6_5dBI4R2bWipaw";
        const API_KEY = "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";
        const CLIENT_ID = "283451960307-saoo2f2fjnprpk9sleugnlc7757pt31d.apps.googleusercontent.com";
        const SCOPES = "https://www.googleapis.com/auth/spreadsheets";

        function gapiLoad() {
            gapi.load("client:auth2", initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                scope: SCOPES
            }).then(() => {
                loadEmployees();
            }).catch(error => {
                console.error("Error initializing Google API:", error);
            });
        }

        function loadEmployees() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: "Employees!A2:D"
            }).then(response => {
                let employees = response.result.values || [];
                let table = document.getElementById("payrate-table");
                table.innerHTML = ""; // Clear table

                employees.forEach(emp => addEmployeeRow(emp[0], emp[1], emp[2], emp[3]));
            }).catch(error => {
                console.error("Error loading employees:", error);
            });
        }

        function addEmployee() {
            addEmployeeRow("", "", "", "");
        }

        function addEmployeeRow(name, normalPay, satPay, sunPay) {
            let table = document.getElementById("payrate-table");
            let row = document.createElement("tr");
            row.innerHTML = `
                <td><input type="text" value="${name}" class="emp-name"></td>
                <td><input type="number" value="${normalPay}" class="emp-pay"></td>
                <td><input type="number" value="${satPay}" class="emp-sat-pay"></td>
                <td><input type="number" value="${sunPay}" class="emp-sun-pay"></td>
                <td><button onclick="removeEmployee(this)">‚ùå</button></td>
            `;
            table.appendChild(row);
        }

        function removeEmployee(button) {
            button.parentElement.parentElement.remove();
        }

        function saveEmployeeData() {
            let rows = document.querySelectorAll("#payrate-table tr");
            let values = Array.from(rows).map(row => {
                let inputs = row.querySelectorAll("input");
                return [inputs[0].value, inputs[1].value, inputs[2].value, inputs[3].value];
            });

            gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: SPREADSHEET_ID,
                range: "Employees!A2:D",
                valueInputOption: "RAW",
                resource: { values: values }
            }).then(() => {
                alert("Employees updated successfully!");
                localStorage.setItem("updateSchedule", "true"); // Notify employee scheduling page
            }).catch(error => {
                console.error("Error updating employees:", error);
            });
        }

        gapiLoad();
    </script>
</body>
</html>

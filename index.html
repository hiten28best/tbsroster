<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Scheduling</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h2>Employee Scheduling</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Employee</th>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>Wednesday</th>
                <th>Thursday</th>
                <th>Friday</th>
                <th>Saturday</th>
                <th>Sunday</th>
            </tr>
        </thead>
        <tbody id="schedule-table">
            <!-- Employee schedule will be loaded dynamically -->
        </tbody>
    </table>

    <button onclick="saveSchedule()">Save Schedule</button>

    <script>
        const SPREADSHEET_ID = "1NombWTsHDX-zvugvEYihqTld1mmh6_5dBI4R2bWipaw";

        function gapiLoad() {
            gapi.load("client:auth2", initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: "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",
                clientId: "283451960307-saoo2f2fjnprpk9sleugnlc7757pt31d.apps.googleusercontent.com",
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                scope: "https://www.googleapis.com/auth/spreadsheets"
            }).then(() => {
                loadEmployees();
            });
        }

        function loadEmployees() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: "Employees!A2:D"
            }).then(response => {
                let employees = response.result.values || [];
                let table = document.getElementById("schedule-table");
                table.innerHTML = ""; // Clear table

                employees.forEach(emp => {
                    let row = document.createElement("tr");
                    row.innerHTML = `<td>${emp[0]}</td>` + 
                        Array(7).fill(0).map((_, i) => `<td><input type="time" class="start${i}"> - <input type="time" class="end${i}"></td>`).join('');
                    table.appendChild(row);
                });
            });
        }

        function saveSchedule() {
            let rows = document.querySelectorAll("#schedule-table tr");
            let values = Array.from(rows).map(row => {
                let name = row.cells[0].innerText;
                let schedule = [];
                for (let i = 1; i <= 7; i++) {
                    let start = row.cells[i].querySelector("input:first-child").value || "";
                    let end = row.cells[i].querySelector("input:last-child").value || "";
                    schedule.push(`${start}-${end}`);
                }
                return [name, ...schedule];
            });

            gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: SPREADSHEET_ID,
                range: "Schedule!A2:H",
                valueInputOption: "RAW",
                resource: { values: values }
            }).then(() => {
                alert("Schedule saved successfully!");
            }).catch(error => {
                console.error("Error saving schedule:", error);
            });
        }

        window.onload = function () {
            if (localStorage.getItem("updateSchedule") === "true") {
                localStorage.removeItem("updateSchedule"); // Clear flag
                location.reload();
            }
            gapiLoad();
        };
    </script>
</body>
</html>

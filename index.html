<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Scheduling</title>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        loadEmployees();
        loadSchedule(); // Load saved schedule when page loads
    });

    window.addEventListener("storage", function () {
        loadEmployees();
    });

    function loadEmployees() {
        let employees = JSON.parse(localStorage.getItem("employees")) || [];
        let tableBody = document.querySelector("tbody");

        tableBody.innerHTML = ""; // Clear existing rows

        employees.forEach((emp, index) => {
            let row = `<tr class="employee-row" data-index="${index}" data-normal-pay="${emp.normalPay}" data-sat-pay="${emp.satPay}" data-sun-pay="${emp.sunPay}">
                <td>${emp.name}</td>
                <td><input type="time" class="start0"> - <input type="time" class="end0"></td>
                <td><input type="time" class="start1"> - <input type="time" class="end1"></td>
                <td><input type="time" class="start2"> - <input type="time" class="end2"></td>
                <td><input type="time" class="start3"> - <input type="time" class="end3"></td>
                <td><input type="time" class="start4"> - <input type="time" class="end4"></td>
                <td><input type="time" class="start5"> - <input type="time" class="end5"></td>
                <td><input type="time" class="start6"> - <input type="time" class="end6"></td>
                <td class="normal-hours"></td>
                <td class="normal-pay"></td>
                <td class="sat-hours"></td>
                <td class="sat-pay"></td>
                <td class="sun-hours"></td>
                <td class="sun-pay"></td>
                <td class="total-hours"></td>
                <td class="total-payroll"></td>
            </tr>`;
            tableBody.innerHTML += row;
        });

        loadSchedule(); // Restore schedule data after adding employees
    }

    function saveSchedule() {
        let schedule = [];
        let rows = document.querySelectorAll(".employee-row");

        rows.forEach((row, index) => {
            let times = [];
            for (let i = 0; i < 7; i++) {
                let start = row.querySelector(`.start${i}`).value;
                let end = row.querySelector(`.end${i}`).value;
                times.push({ start, end });
            }
            schedule.push({ employeeIndex: index, times });
        });

        localStorage.setItem("schedule", JSON.stringify(schedule));
    }

    function loadSchedule() {
        let schedule = JSON.parse(localStorage.getItem("schedule")) || [];

        schedule.forEach(data => {
            let row = document.querySelector(`.employee-row[data-index="${data.employeeIndex}"]`);
            if (row) {
                data.times.forEach((time, i) => {
                    row.querySelector(`.start${i}`).value = time.start || "";
                    row.querySelector(`.end${i}`).value = time.end || "";
                });
            }
        });
    }

    function resetSchedule() {
        if (confirm("Do you really want to reset the schedule?")) {
            localStorage.removeItem("schedule");
            document.querySelectorAll("input[type='time']").forEach(input => input.value = "");
        }
    }

    // Auto-save whenever time inputs change
    document.addEventListener("input", function (event) {
        if (event.target.type === "time") {
            saveSchedule();
        }
    });
</script>

</head>
<body>
    <h2>Employee Scheduling</h2>
    <label for="start-date">Select Start Date: </label>
    <input type="date" id="start-date" onchange="updateDates()">
    <button onclick="calculatePayroll()">Calculate Hours & Payroll</button>
    <button onclick="resetSchedule()">Reset Schedule</button>

    <table border="1">
        <thead>
            <tr>
                <th>Employee Name</th>
                <th id="day0"></th>
                <th id="day1"></th>
                <th id="day2"></th>
                <th id="day3"></th>
                <th id="day4"></th>
                <th id="day5"></th>
                <th id="day6"></th>
                <th>Normal Hours</th>
                <th>Normal Pay</th>
                <th>Sat Hours</th>
                <th>Sat Pay</th>
                <th>Sun Hours</th>
                <th>Sun Pay</th>
                <th>Total Hours</th>
                <th>Total Payroll</th>
            </tr>
        </thead>
        <tbody>
            <tr class="employee-row" data-normal-pay="20" data-sat-pay="25" data-sun-pay="30">
                <td>John Doe</td>
                <td><input type="time" class="start0"> - <input type="time" class="end0"></td>
                <td><input type="time" class="start1"> - <input type="time" class="end1"></td>
                <td><input type="time" class="start2"> - <input type="time" class="end2"></td>
                <td><input type="time" class="start3"> - <input type="time" class="end3"></td>
                <td><input type="time" class="start4"> - <input type="time" class="end4"></td>
                <td><input type="time" class="start5"> - <input type="time" class="end5"></td>
                <td><input type="time" class="start6"> - <input type="time" class="end6"></td>
                <td class="normal-hours"></td>
                <td class="normal-pay"></td>
                <td class="sat-hours"></td>
                <td class="sat-pay"></td>
                <td class="sun-hours"></td>
                <td class="sun-pay"></td>
                <td class="total-hours"></td>
                <td class="total-payroll"></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="14">Total</td>
                <td id="total-hours"></td>
                <td id="total-payroll"></td>
            </tr>
        </tfoot>
    </table>
</body>
</html>
